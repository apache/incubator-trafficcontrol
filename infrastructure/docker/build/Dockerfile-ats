# Dockerfile to builds Apache Traffic Server as part of Apache Traffic Control
#
#  Instructions:
#    Optionally provide ATS github repo URL and branch name
# 
FROM centos:7
MAINTAINER Eric Friedrich 

ENV ts_git_repo=https://github.com/apache/trafficserver.git
ENV ts_git_branch=master

# top level of trafficcontrol directory must be mounted as a volume:
# docker run --volume /trafficcontrol:$(pwd) ...
VOLUME /trafficcontrol

RUN yum -y install \
           git \ 
           rpm-build \
           gcc && \
    yum clean all

RUN yum -y install \
           gcc-c++ \
           pkgconfig \
           pcre-devel \
           tcl-devel \
           expat-devel \
           openssl-devel \
           perl-ExtUtils-MakeMaker \
           libcap \
           libcap-devel \
           hwloc \
           hwloc-devel \
           ncurses-devel \
           libcurl-devel \
           libunwind \
           libunwind-devel \
           autoconf \
           automake \
           libtool \
           make && \
    yum clean all

RUN getent group ats >/dev/null || \
         groupadd -r ats &&  \
    getent passwd ats >/dev/null || \
         useradd -r -g ats -d / -s /sbin/nologin \
         -c "Apache Traffic Server" ats 

ADD infrastructure/docker/build/clean_build.sh /
CMD /clean_build.sh traffic_server

# vi:syntax=Dockerfile
