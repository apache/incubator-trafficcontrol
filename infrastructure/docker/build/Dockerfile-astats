# Dockerfile to builds Apache Traffic Server astats plugin
#   Plugin lives in Apache Traffic Control git repo
#   Plugin build requires tsxs script and ATS includes
#
#  Instructions:
#    Build container providing path to TC top level (as a volume), ATS repo URL, and ATS branch name
#    Example:
#       docker build ....
#  
#    Output will be located in specified output directory 
FROM centos:7
MAINTAINER Eric Friedrich 

ENV ts_git_repo=https://github.com/apache/trafficserver.git
ENV ts_git_branch=master

# top level of trafficcontrol directory must be mounted as a volume:
# docker run --volume /trafficcontrol:$(pwd) ...
VOLUME /trafficcontrol

RUN yum -y install \
           git \ 
           rpm-build \
           gcc && \
    yum clean all

RUN yum -y install \
    gcc-c++ pkgconfig pcre-devel tcl-devel expat-devel openssl-devel perl-ExtUtils-MakeMaker libcap libcap-devel hwloc hwloc-devel ncurses-devel libcurl-devel libunwind libunwind-devel autoconf automake libtool tar xz bzip2 make && \
  yum clean all

ADD infrastructure/docker/build/clean_build.sh /
CMD /clean_build.sh traffic_server/plugins/astats_over_http

# vi:syntax=Dockerfile
